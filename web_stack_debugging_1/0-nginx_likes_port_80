#!/usr/bin/env bash
# Install and configure nginx to listen on port 80

# Update package lists
apt-get update -y

# Install nginx, forcing install even if packages are unauthenticated
apt-get install -y nginx || apt-get install -y --allow-unauthenticated nginx

# If the default site config exists, make sure it listens on IPv4 port 80
if [ -f /etc/nginx/sites-enabled/default ]; then
  sed -i 's/#\?listen 80 default_server;/listen 80 default_server;/' /etc/nginx/sites-enabled/default
  sed -i 's/#\?listen \[::\]:80 default_server;/listen [::]:80 default_server;/' /etc/nginx/sites-enabled/default
fi

# Start or restart nginx
service nginx restart || service nginx start
